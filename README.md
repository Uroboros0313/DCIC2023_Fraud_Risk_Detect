# 竞赛介绍
- 比赛链接: [科技金融应用：欺诈风险识别](https://www.dcic-china.com/competitions/10060)

- 赛题名称：  
科技金融应用——欺诈风险识别（通过资金交易流水识别涉诈涉赌账户）

- 出题单位：   
兴业银行股份有限公司

- 赛题背景：    
近年来，跨境赌博、电信网络诈骗、黑产等外部欺诈违法犯罪形势日益严峻，呈现线上化、产业化、团伙化等特征，国家层面高度重视反欺诈治理工作，执法和监管机构对反欺诈管理要求日趋严格。党的二十大的报告中发布了“以人民为中心”“统筹发展与安全”的重要指示。银行业金融机构需筑牢反欺诈“防火墙”，为业务的健康发展保驾护航；践行金融为民，坚决守护人民群众的财产安全，提高人民群众的幸福感、安全感和获得感；牢牢把握金融工作的政治性、人民性，提升专业性。同时，监管机构要求各家银行开发和运用有效的金融科技和大数据系统，分析涉赌涉诈资金交易新方式，总结资金风险新特征，持续优化风险监测模型，全面排查存量风险。于2022年12月正式施行的《中华人民共和国反电信网络诈骗法》把反欺诈工作上升到了法律层面。该法案亦指出，银行业金融机构应当建立完善符合电信网络诈骗活动特征的异常账户和可疑交易的监测机制。

- 赛题任务：   
本赛题旨在运用有效的金融科技和大数据系统，分析涉赌涉诈资金交易新方式，持续优化风险监测模型，通过赛题提供的涉赌涉诈黑名单、白名单及用于训练的相关交易流水数据集，构建涉赌涉诈账户算法识别模型，全面排查存量风险。

# 解决方案

- A榜: 第14名, F1分数0.88763411
- B榜: 第8, F1分数0.89313836
## 文件结构
```
│  inference_run.sh(预测入口函数)
│  README.md(解决方案介绍文档)
│  requirements.txt(python包版本)
│
├─code
│      constant.py(常量文件)
│      data_utils.py(数据读取工具函数)
│      feature.py(特征工程工具函数)
│      main.py(入口主函数)
│      model.py(模型函数)
|
|
├─prediction_result
│
├─process_data
│      user_record_and_static_info_df.csv(中间特征文件)
│
└─raw_data
        submit_example.csv
        test_dataset.csv
        数据说明.xlsx
        训练集标签.csv
        账户交易信息.csv
```
   
## 环境及结果说明

- 开发环境: Windows11
- Docker验证环境: `registry.cn-shanghai.aliyuncs.com/tcc-public/python:3`
- python版本: 3.7.3
- Docker验证环境镜像打包: [数据竞赛创建Docker环境及复现精简教程](https://zhuanlan.zhihu.com/p/363635536)

```
PS: python、包版本、随机数种子相同的情况下有结果集有14个样本不一致
```

## 运行说明

- A/B榜单数据放在`raw_data`中
- 运行`sh ./inference_run.sh`

## 解决方案

### 特征工程

- 转账人数
- 入账/出账借贷标志, 入账借贷标志比例
- 交易金额、账户余额, 交易渠道等类别型变量分组统计值在生命周期内的统计值(最小值,最大值,标准差,中位数,均值,极差)
- 不同借贷标志下交易金额的分组统计值以及入账出账比例
- 不同接待标记下对方账户的个数, 出入账不同账户的个数
- 样本生命周期长度、样本平均交易间隔时间
- 交易间隔时间的统计值, 每笔交易流水datetime的统计值
- 交易渠道进行类别型编码后计算用户统计值

### 模型

#### 一层模型
- 单模: catboost, lightgbm, gbdt, xgboost, histboost, 每一类模型进行十折oof, 每折模型的seed不同, 每一类模型的阈值利用oof确定。
2. Stacking: catboost, lightgbm, gbdt, xgboost, histboost作为基分类器, 二层分类器用逻辑回归, 十折oof确定阈值。

#### 二层模型
1. HardVoting: 上述模型等权进行硬投票

## 思路

- 强特征: 交易间隔时间统计值、出入账不同账户个数、交易渠道目标编码的统计值
- 单模A榜最高histboost, 上线分数0.880+
- 模型融合:
  - Voting融合:   
        风控数据泛化性较弱, 当固定同一个SEED且使用软投时, 模型同质性过高, 会导致模型在测试集结果不稳定(即集成接近于单模不集成)。需要增加基分类器的异质性提高融合模型的稳定性。进一步的思路是对模型超参进行随机扰动。A榜上线分数0.886+
    - KFold交叉验证以后进行OOF定阈后SoftVoting融合, KFold模型固定SEED
    - KFold交叉验证以后进行OOF定阈后HardVoting融合, KFold模型固定同一SEED
    - KFold交叉验证以后进行OOF定阈后HardVoting融合, KFold模型固定不同SEED(**最终方案**)
  - Stacking融合: 
    - 基模型融合效果不如硬投票, 但和硬投融合后上线效果提升了, 同样需要改变SEED, A榜上线0.885+。
  - Stacking结果加入原本的投票融合后A榜上线0.887+
